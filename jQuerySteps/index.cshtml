
@{
    ViewBag.Title = "index";
    Layout = "~/Views/Shared/_LayoutUmega.cshtml";
}

@section Styles{
    <link href="~/Content/umega/jquery.steps.css" rel="stylesheet" />
    <style>
        .form-group {
            margin: 0.75em;
        }

        .middle-text {
            text-align: center;
        }
    </style>


}

<form id="steps-form" action="#">
    <!--BEGIN OF GET STARTED-->
    <h3>Get Started, Man!</h3>
    <fieldset id="startedInfo">
        <legend>UPGRADE TO DEALER ACCOUNT IN JUST FEW STEPS </legend>

        <div class="row">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="txtZipPostalShipping" class="col-sm-3 col-md-4 control-label">Email</label>
                    <div class="col-sm-9 col-md-8">
                        <input id="DealerEmail" name="email" type="text" class="form-control">
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label for="txtZipPostalShipping" class="col-sm-3 col-md-4 control-label">Company Name</label>
                    <div class="col-sm-9 col-md-8">
                        <input id="DealerCompanyName" name="companyName" type="text" class="form-control">
                    </div>
                </div>
            </div>

        </div>
    </fieldset>
    <!--END OF GET STARTED-->

    <h3>Address</h3>  <!--BEGIN OF ADDRESS FORM-->
    <fieldset id="form-horizontal-p-1" role="tabpanel" aria-labelledby="form-horizontal-h-1" class="body" aria-hidden="true" style="display: none;">
        <legend>Address Information</legend>
        <div id="addressForm">
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="textinput" class="col-sm-3 col-md-4 control-label">Address 1</label>
                        <div class="col-sm-9 col-md-8">
                            <textarea id="Line" name="Line" class="form-control"></textarea>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="txtAddress2Shipping" class="col-sm-3 col-md-4 control-label">Address 2</label>
                        <div class="col-sm-9 col-md-8">
                            <textarea id="LineTwo" name="LineTwo" class="form-control"></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="txtZipPostalShipping" class="col-sm-3 col-md-4 control-label">City</label>
                        <div class="col-sm-9 col-md-8">
                            <input id="city" name="city" type="text" class="form-control">
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="txtZipPostalShipping" class="col-sm-3 col-md-4 control-label">Zip/Postal Code</label>
                        <div class="col-sm-9 col-md-8">
                            <input id="zipCode" name="zipCode" type="text" class="form-control">
                        </div>
                    </div>
                </div>

            </div>

            <div class="row">
                <div class="col-lg-offset-6">
                    <div class="form-group">
                        <label for="ddlCountryShipping" class="col-sm-3 col-md-4 control-label">State</label>
                        <div class="col-sm-9 col-md-8">

                            <select class="form-control" id="stateId" name="stateId">
                                <option value=""> - </option>
                                <option value="AK">Alaska</option>
                                <option value="AL">Alabama</option>
                                <option value="AR">Arkansas</option>
                                <option value="AZ">Arizona</option>
                                <option value="CA">California</option>
                                <option value="CO">Colorado</option>
                                <option value="CT">Connecticut</option>
                                <option value="DC">District of Columbia</option>
                                <option value="DE">Delaware</option>
                                <option value="FL">Florida</option>
                                <option value="GA">Georgia</option>
                                <option value="HI">Hawaii</option>
                                <option value="IA">Iowa</option>
                                <option value="ID">Idaho</option>
                                <option value="IL">Illinois</option>
                                <option value="IN">Indiana</option>
                                <option value="KS">Kansas</option>
                                <option value="KY">Kentucky</option>
                                <option value="LA">Louisiana</option>
                                <option value="MA">Massachusetts</option>
                                <option value="MD">Maryland</option>
                                <option value="ME">Maine</option>
                                <option value="MI">Michigan</option>
                                <option value="MN">Minnesota</option>
                                <option value="MO">Missouri</option>
                                <option value="MS">Mississippi</option>
                                <option value="MT">Montana</option>
                                <option value="NC">North Carolina</option>
                                <option value="ND">North Dakota</option>
                                <option value="NE">Nebraska</option>
                                <option value="NH">New Hampshire</option>
                                <option value="NJ">New Jersey</option>
                                <option value="NM">New Mexico</option>
                                <option value="NV">Nevada</option>
                                <option value="NY">New York</option>
                                <option value="OH">Ohio</option>
                                <option value="OK">Oklahoma</option>
                                <option value="OR">Oregon</option>
                                <option value="PA">Pennsylvania</option>
                                <option value="PR">Puerto Rico</option>
                                <option value="RI">Rhode Island</option>
                                <option value="SC">South Carolina</option>
                                <option value="SD">South Dakota</option>
                                <option value="TN">Tennessee</option>
                                <option value="TX">Texas</option>
                                <option value="UT">Utah</option>
                                <option value="VA">Virginia</option>
                                <option value="VT">Vermont</option>
                                <option value="WA">Washington</option>
                                <option value="WI">Wisconsin</option>
                                <option value="WV">West Virginia</option>
                                <option value="WY">Wyoming</option>
                            </select>

                        </div>
                    </div>
                </div>
            </div>

        </div>
    </fieldset>  <!--END OF ADDRESS FORM-->
    <!--BEGIN CATEGORY MANAGER FORM-->
    <h3>Category</h3>
    <fieldset>
        <legend>Add Category</legend>

        <div id="catForm">
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="txtAddress1Shipping" class="col-sm-3 col-md-4 control-label"> Name</label>
                        <div class="col-sm-9 col-md-8">
                            <textarea id="txtName" name="name" class="form-control"></textarea>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="txtAddress2Shipping" class="col-sm-3 col-md-4 control-label"> Description</label>
                        <div class="col-sm-9 col-md-8">
                            <textarea id="txtMessage" name="description" class="form-control"></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-offset-6">
                    <div class="form-group">
                        <label for="slug" class="col-sm-3 col-md-4 control-label">Slug</label>
                        <input id="slugField" type="text" name="slug" class="form-control text-muted" readonly>

                    </div>
                </div>
            </div>

        </div>


    </fieldset>
    <!--END CATEGORY MANAGER FORM-->

    <h3>Vehicle</h3> <!--BEGIN VEHICLE FORM-->
    <fieldset>
        <legend>Add Vehicle</legend>

        <div class="row">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="vehicleYear" class="col-sm-3 col-md-4 control-label">Year</label>
                    <div class="col-sm-9 col-md-8">
                        <select class="form-control" id="Year" name="Year">
                            <option></option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label for="vehicleMake" class="col-sm-3 col-md-4 control-label">Make</label>
                    <div class="col-sm-9 col-md-8">
                        <select class="form-control" id="Make" name="Make">
                            <option></option>
                        </select>
                    </div>

                    <div class="col-sm-4 vehicleMakeOther hidden">
                        <input type="text" class="form-control" id="vehicleMakeOther" name="MakeOther" placeholder="Make">
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="vehicleModel" class="col-sm-3 col-md-4 control-label">Model</label>
                    <div class="col-sm-9 col-md-8">
                        <select class="form-control" id="Model" name="Model">
                            <option></option>
                        </select>
                    </div>

                    <div class="col-sm-4 vehicleModelOther hidden">
                        <input type="text" class="form-control" id="vehicleModelOther" name="ModelOther" placeholder="Model">
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label for="SellPrice" class="col-sm-3 col-md-4 control-label">Sell Price</label>
                    <div class="col-sm-9 col-md-8">
                        <input type="text" class="form-control" id="SellPrice" name="SellPrice" placeholder="Sell Price">
                    </div>
                </div>
            </div>
        </div>
    </fieldset><!--END VEHICLE FORM-->

</form>



@section Scripts{

    <script src="~/Scripts/umega/jquery.steps.min.js"></script>
    <script src="~/Scripts/services/sabio.services.UpgradeDealer.js"></script>
    <script src="~/Scripts/services/sabio.services.addresses.js"></script>
    <script src="~/Scripts/services/sabio.services.categories.js"></script>
    <script src="~/Scripts/services/sabio.services.vehicles.js"></script>

    <script type="text/javascript">
        sabio.page.modelsArray = [];
        sabio.page.startUp = function () {
            var form = $("#steps-form").show();

            form.steps({
                headerTag: "h3",
                bodyTag: "fieldset",
                transitionEffect: "slideLeft",
                onStepChanging: sabio.page.handlers.onStepChange,
                onFinishing: sabio.page.handlers.onFinish,
                onFinished: sabio.page.handlers.onFinished,
            }).validate({
                errorPlacement: function errorPlacement(error, element) { element.before(error); },
                rules: {
                    "email": {
                        required: true,
                        email: true
                    },
                    "companyName": {
                        required: true
                    },
                    "Line": {
                        required: true  //  Addres is required
                    },
                    "LineTwo": {
                        required: true // Unit/apt/suite # is required
                    },
                    "city": {
                        required: true  
                    },
                    "stateId": {
                        required: true  //  State is required
                    },

                    "zipCode": {
                        required: true  
                    },
                    "name": {
                        required: true 
                    },
                    "description": {
                        required: true
                    },

                    "Year": {
                        required: true  //  vehicleYear is required
                    },
                    "Make": {
                        required: true  
                    },
                    "Model": {
                        required: true  
                    },
                    "SellPrice": {
                        required: true  
                    },


                },
                //  here you can provide custom error messages if you want to - this part is optional
                messages: {
                    "email": {
                        required: "Email is required.",
                        email: "please provide a valid email address."
                    },
                    "companyName": {
                        required: "Company Name is required.",
                    },
                    "Line": {
                        required: "UAddress is required.",
                    },
                    "LineTwo": {
                        required: "Unit/apt/suite # is required.",
                    },
                    "city": {
                        required: "A city name is required.",
                    },
                    "stateId": {
                        required: "Please select your state.",
                    },
                    "zipCode": {
                        required: "A zipcode is required.",

                    },
                    "name": {
                        required: "Name is required",
                    },
                    "description": {
                        required: "Description is required",
                    },
                    "Year": {
                        required: "Year is required.",
                    },
                    "Make": {
                        required: "Make is required.",
                    },
                    "Model": {
                        required: "Model is required.",
                    },
                    "SellPrice": {
                        required: "Sell price is required.",
                    }

                }


            }) //end of .steps

            $('#txtName').on('blur', sabio.page.handlers.convertSlug);//CATEGORY MANAGER FORM

            // *** //***                 BEGIN   VEHICLE FORM                                     *** //***//
            sabio.page.loadYears();
            $('#Year').change(sabio.page.handlers.vehicleYearSelected);
            $('#Make').change(sabio.page.handlers.vehicleMakeSelected);
            $('#Model').change(sabio.page.handlers.vehicleModelSelected);
            // *** //***                 END VEHICLE FORM                                     *** //***//




        } //end of startUp

        sabio.page.handlers.onStepChange = function (event, currentIndex, newIndex) {
            // Allways allow previous action even if the current form is not valid!
            var form = $("#steps-form");

            if (currentIndex > newIndex) {
                return true;
            }

            // Needed in some cases if the user went back (clean up)
            if (currentIndex < newIndex) {
                // To remove error styles
                form.find(".body:eq(" + newIndex + ") label.error").remove();
                form.find(".body:eq(" + newIndex + ") .error").removeClass("error");
            }
            form.validate().settings.ignore = ":disabled,:hidden";
            // GET STARTED AJAX CALL
            switch (currentIndex) {
                case 0:
                    var startData = {
                        Email: $("#DealerEmail").val(),
                        DealerName: $("#DealerCompanyName").val()
                    }
                    sabio.services.UpgradeDealer.startInsertDealerInfo(startData, sabio.page.handlers.onCreateDealerSuccess, sabio.page.AjaxError);

                    console.log("start form submiting", startData);
                    break;

                case 1:
                    var addressData = {
                        Line: $("#Line").val(),
                        LineTwo: $("#LineTwo").val(),
                        City: $("#city").val(),
                        ZipCode: $("#zipCode").val(),
                        StateId: $("#stateId").val()
                    }
                    sabio.services.addresses.createAddress(addressData, sabio.page.handlers.onAddressCreateSuccess, sabio.page.AjaxError);
                    console.log("address ajax", addressData);
                    break;
                case 2:
                    var catData = {
                        name: $("#txtName").val(),
                        description: $("#txtMessage").val(),
                        slug: $("#slugField").val()
                    }
                    sabio.services.categories.insertCat(catData, sabio.page.handlers.onCatCreateSuccess, sabio.page.AjaxError);
                    console.log("cat ajax", catData);
                    break;

            }//END OF SWITCH

            console.log("index", currentIndex, newIndex);
            return form.valid();
        }
        sabio.page.handlers.onFinish = function (event, currentIndex) {
            var form = $("#steps-form");
            form.validate().settings.ignore = ":disabled";
            var vehicleData = {
                Year: $("#Year").val(),
                Make: $("#Make").val(),
                Model: $("#Model").val(),
                SellPrice: $("#SellPrice").val()
            }
            sabio.services.vehicles.addVehicle(vehicleData, sabio.page.handlers.onVehicleCreateSuccess, sabio.page.AjaxError);
            console.log("vehicle ajax", vehicleData);
            return form.valid();
        }
        sabio.page.handlers.onFinished = function (event, currentIndex) {
            alert("Submitted!");
        }

        sabio.page.handlers.convertSlug = function () {
            console.log("on blur working")
            var nameInput = $('#txtName').val();
            $('#slugField').val(nameInput.toLowerCase().replace(/[^\w ]+/g, '').replace(/ +/g, '-'));

        }//END CATEGORY MANAGER FORM



        //BEGIN VEHICLE FORM
        sabio.page.loadYears = function () {
            for (var i = 1990; i < 2017; i++) {
                $('<option/>', {
                    value: i,
                    html: i
                }).appendTo('#Year');
            }
        };

        sabio.page.handlers.vehicleYearSelected = function () {
            var year = $('#Year').val();
            //console.log(year);
            $('.vehicleMakeOther, .vehicleModelOther').addClass('hidden');
            $('#Make option').remove();
            $('#Model option').remove();
            sabio.page.loadMakes(year);
        };

        sabio.page.handlers.vehicleMakeSelected = function () {
            var make = $('#Make').val();
            //console.log(make);
            if (make === 'Other') {
                // show others input
                $('.vehicleMakeOther, .vehicleModelOther').removeClass('hidden');
                // change model selection to Other
                $('<option/>', { value: 'Other', html: 'Other' }).appendTo('#Model');
                $('#Model').find("option[value='Other']").attr('selected', true);
            } else {
                $('.vehicleMakeOther, .vehicleModelOther').addClass('hidden');
                sabio.page.loadModels(make);
            }

        };

        sabio.page.handlers.vehicleModelSelected = function () {
            var model = $('#Model').val();
            if (model === 'Other') {
                // show others input
                $('.vehicleModelOther').removeClass('hidden');
            } else {
                $('.vehicleModelOther').addClass('hidden');
                //sabio.page.loadModels(make);
            }

        }

        sabio.page.loadMakes = function (year) {
            sabio.services.vehicles.loadMakes(year, sabio.page.populateMakes, sabio.page.ajaxError);
        };

        sabio.page.populateMakes = function (makeObj) {
            // the makeObj has an Array, the makes are in the array
            //console.log("there are " + makeObj.makes.length + "makes");
            // remove all options first
            $('#Make option').remove();
            $('<option/>', { value: '', html: '' }).appendTo('#Make');
            sabio.page.modelsArray = makeObj.makes;
            console.log("model array here is " + sabio.page.modelsArray);
            for (var i = 0; i < sabio.page.modelsArray.length; i++) {
                //console.log(makes.makes[i]);
                $('<option/>', {
                    value: sabio.page.modelsArray[i].name,
                    html: sabio.page.modelsArray[i].name
                }).appendTo('#Make');
                // makeArry[i] also comes with model informaton, need to pass it to
                // models after a make is selected
            }
            $('<option/>', { value: 'Other', html: 'Other' }).appendTo('#Make');

            // if it's an update, then select the vehicle Make
            if (sabio.page.updateVehicleObj != null) {
                var isNotOther = false;
                // check if the make is in the list, if not, put it in others
                for (var i = 0; i < sabio.page.modelsArray.length; i++) {
                    if (sabio.page.modelsArray[i].name === sabio.page.updateVehicleObj.vehicleMake) {
                        isNotOther = true;
                    }
                }
                if (isNotOther == true) {
                    $('#Make').val(sabio.page.updateVehicleObj.vehicleMake);
                    sabio.page.loadModels(sabio.page.updateVehicleObj.vehicleMake);
                } else {
                    $('.vehicleMakeOther, .vehicleModelOther').removeClass('hidden');
                    $('#Make').val("Other");
                    $('#vehicleMakeOther').val(sabio.page.updateVehicleObj.vehicleMake);
                    console.log(sabio.page.updateVehicleObj.vehicleMake);
                    $('<option/>', { value: 'Other', html: 'Other' }).appendTo('#Model');
                    $('#Model').find("option[value='Other']").attr('selected', true);
                    $('#vehicleModelOther').val(sabio.page.updateVehicleObj.vehicleModel);
                }

            }
        };


        sabio.page.loadModels = function (make) {

            console.log("load model by " + make);
            var models = sabio.page.modelsArray;

            //console.log("models here are " + sabio.page.modelsArray);
            //console.log(models);
            for (i = 0; i < models.length; i++) {
                if (models[i].name === make) {
                    //console.log(models[i]);
                    sabio.page.populateModels(models[i].models);
                    break;
                }
            }
        };

        sabio.page.populateModels = function (modelsArray) {
            // clean out the options first
            $('#Model option').remove();
            $('<option/>', { value: '', html: '' }).appendTo('#Model');
            for (var i = 0; i < modelsArray.length; i++) {
                //console.log(modelsArray);
                $('<option/>', {
                    value: modelsArray[i].name,
                    html: modelsArray[i].name
                }).appendTo('#Model');
                // makeArry[i] also comes with model informaton, need to pass it to
                // models after a make is selected
            }
            $('<option/>', { value: 'Other', html: 'Other' }).appendTo('#Model');
            if (sabio.page.updateVehicleObj != null) {
                var isNotOther = false;
                // check if the make is in the list, if not, put it in others
                for (var i = 0; i < modelsArray.length; i++) {
                    if (modelsArray[i].name === sabio.page.updateVehicleObj.vehicleModel) {
                        isNotOther = true;
                    }
                }
                if (isNotOther == true) {
                    $('#Model').val(sabio.page.updateVehicleObj.vehicleModel);
                    //sabio.page.loadModels(sabio.page.updateVehicleObj.vehicleMake);
                } else {
                    $('.vehicleModelOther').removeClass('hidden');
                    //$('#Make').val("Other");
                    $('#vehicleModelOther').val(sabio.page.updateVehicleObj.vehicleModel);
                    console.log(sabio.page.updateVehicleObj.vehicleMake);
                    //$('<option/>', { value: 'Other', html: 'Other' }).appendTo('#Model');
                    $('#Model').find("option[value='Other']").attr('selected', true);
                    //$('#vehicleModelOther').val(sabio.page.updateVehicleObj.vehicleModel);
                }
            }
        }

        //END VEHICLE FORM

        sabio.page.handlers.clearForm = function () {//
            $('#steps-form')[0].reset();

        };


        sabio.page.handlers.onCreateDealerSuccess = function (data, status, xhr) {
            sabio.page.dealerId = data.item //check network response tab or response.item
            console.log("save dealerId", sabio.page.dealerId);

        }

        sabio.page.handlers.onAddressCreateSuccess = function (data, status, xhr) {
            sabio.page.addressId = data.item
            console.log("save addressId", sabio.page.addressId);
            var payload = {
                AddressId: sabio.page.addressId,
                DealerId: sabio.page.dealerId
            }
            sabio.services.UpgradeDealer.onAddressCreateSuccess(payload, sabio.page.handlers.onDealerAddressSuccess, sabio.page.AjaxError);
            console.log("2 ids", payload);
        }

        sabio.page.handlers.onDealerAddressSuccess = function (data, status, xhr) {
            console.log("DealerAddressSuccess");
        }
        sabio.page.handlers.onCatCreateSuccess = function (data, status, xhr) {
            sabio.page.catId = data.item;
            console.log("save catId", sabio.page.catId);
            var payload = {
                CatId: sabio.page.catId,
                DealerId: sabio.page.dealerId
            }
            sabio.services.UpgradeDealer.onCatCreateSuccess(payload, sabio.page.AjaxSuccess, sabio.page.AjaxError);

        }

        sabio.page.handlers.onVehicleCreateSuccess = function (data) {
            sabio.page.vehicleId = data.item;
            var payload = {
                VehicleId: sabio.page.vehicleId,
                DealerId: sabio.page.dealerId
            }
            sabio.services.UpgradeDealer.onVehicleCreateSuccess(payload, sabio.page.AjaxSuccess, sabio.page.AjaxError);
            console.log("save vehicleId", sabio.page.vehicleId, sabio.page.dealerId);
        }
        sabio.page.AjaxSuccess = function (data, status, xhr) {
            console.log("ajax success creating messages")



        }

        sabio.page.AjaxError = function (jqXHR, textStatus, errorThrown) {

            console.error("error creating messages", jqXHR);
        }

    </script>



}
